<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Document Manager — Report</title>

    <link rel="icon" href="https://www.pristinepearlpharma.in/images/alt-logo.png" type="image/png" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        /* ---------- Theme (kept similar to your previous) ---------- */
        :root{
            --primary:#5eead4;
            --primary-dark:#2dd4bf;
            --bg:#111827;
            --surface:#1f2937;
            --border:#374151;
            --text:#f3f4f6;
            --muted:#9ca3af;
            --success:#4ade80;
            --error:#f87171;
            --card-shadow: 0 8px 30px rgba(0,0,0,0.6);
        }
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:Inter,system-ui,Segoe UI,Arial;background:var(--bg);color:var(--text);min-height:100vh}
        .app-container{display:flex;min-height:100vh}
        /* Sidebar */
        .sidebar{width:320px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column}
        .logo-section{padding:20px;border-bottom:1px solid var(--border);display:flex;gap:12px;align-items:center}
        .logo{width:48px;height:48px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));display:flex;align-items:center;justify-content:center;border-radius:10px;color:#111827;font-weight:700}
        .filter-section{padding:22px;flex:1;display:flex;flex-direction:column;gap:18px}
        .section-title{display:flex;gap:10px;align-items:center;color:var(--primary)}
        .filter-label{font-size:0.85rem;color:var(--muted);display:flex;gap:8px;align-items:center;margin-bottom:6px}
        .filter-input{width:100%;padding:10px 12px;border-radius:8px;background:#0f1724;border:1px solid var(--border);color:var(--text)}
        .btn{padding:12px 14px;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#111827;font-weight:700}
        .btn-secondary{background:linear-gradient(135deg,var(--muted),#475569);color:var(--text);margin-top:6px}
        .stats-card{background:#0f1724;border:1px solid var(--border);padding:12px;border-radius:8px}
        .stats-title{color:var(--muted);font-size:0.8rem}
        .stats-value{color:var(--primary);font-size:1.6rem;font-weight:700}
        /* main */
        .main-content{flex:1;display:flex;flex-direction:column;overflow:auto}
        .header{background:var(--surface);border-bottom:1px solid var(--border)}
        .header-content{padding:18px 28px;display:flex;justify-content:space-between;align-items:center}
        .page-title{font-size:1.25rem;font-weight:600}
        .results-section{padding:22px;background:var(--bg);flex:1;overflow:auto}
        .table-container{background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:auto}
        table{width:100%;border-collapse:collapse}
        th{background:#141922;color:var(--muted);padding:12px 14px;text-align:left;font-size:0.85rem;font-weight:700;text-transform:uppercase;border-bottom:1px solid var(--border)}
        td{padding:12px 14px;border-bottom:1px solid var(--border);vertical-align:top;font-size:0.95rem}
        tr:hover td{background:#222b35}
        .status-badge{padding:4px 8px;border-radius:6px;font-weight:700;font-size:0.75rem;display:inline-block}
        .status-expired{background:#3a0d0d;color:var(--error);border:1px solid #7f1d1d}
        .status-valid{background:#08352a;color:var(--success);border:1px solid #065f46}
        .document-link{display:inline-flex;gap:8px;align-items:center;padding:6px 8px;border-radius:6px;text-decoration:none;background:#0f1724;border:1px solid #0b5b49;color:var(--primary)}
        .no-results{text-align:center;padding:40px;color:var(--muted)}
        .loading{padding:40px;text-align:center;color:var(--muted)}
        .login-card{background:var(--surface);padding:34px;border-radius:12px;box-shadow:var(--card-shadow);border:1px solid var(--border);text-align:center;width:92%;max-width:420px}
        .login-input{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0f1724;color:var(--text);margin-bottom:12px}
        .login-error{display:none;background:#2b0b0b;padding:10px;border-radius:8px;color:var(--error);margin-bottom:12px}
        @media (max-width:1000px){.app-container{flex-direction:column}.sidebar{width:100%}}
    </style>
</head>
<body>
    <!-- Simple password gate -->
    <div id="loginScreen" style="position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:50">
        <div class="login-card">
            <h2 style="display:flex;align-items:center;gap:10px;justify-content:center;color:var(--primary)"><i class="fas fa-lock"></i> Secure Login</h2>
            <p style="color:var(--muted);margin-top:6px;margin-bottom:16px">Enter the master password to access the Document Repository</p>
            <form id="loginForm" onsubmit="return false;">
                <input id="passwordInput" class="login-input" type="password" placeholder="Enter password" required />
                <div id="loginError" class="login-error"><i class="fas fa-times-circle"></i> Invalid password</div>
                <button id="loginBtn" class="btn" style="width:100%;"><i class="fas fa-sign-in-alt"></i> ACCESS DATA</button>
            </form>
            <p style="font-size:0.8rem;color:#4b5563;margin-top:12px">Hint: pearl</p>
        </div>
    </div>

    <div class="app-container" id="mainApp" style="display:none">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">PP</div>
                <div>
                    <div style="font-weight:700">PRISTINE PEARL</div>
                    <div style="color:var(--primary);font-weight:700">DOCUMENT MANAGER</div>
                </div>
            </div>

            <div class="filter-section">
                <div>
                    <div class="section-title"><i class="fas fa-sliders-h"></i> FILTER DOCUMENTS</div>
                    <p style="color:var(--muted);margin-top:6px;font-size:0.9rem">Use filters to find specific documents quickly</p>
                </div>

                <form id="documentSearchForm" style="display:flex;flex-direction:column;gap:12px">
                    <!-- Hidden placeholder sheet ID - editable if needed -->
                    <input type="text" id="sheetId" value="1gSZTk3PIu2MEvg_ElgHE3i8tsKzT9CnNIeBtgC8YwpI" style="display:none" />

                    <div>
                        <label class="filter-label"><i class="fas fa-search"></i> Search</label>
                        <input id="searchTerm" class="filter-input" placeholder="Search name, code, remarks, file..." />
                    </div>

                    <div>
                        <label class="filter-label"><i class="fas fa-building"></i> Company</label>
                        <select id="companyFilter" class="filter-input"><option value="">All Companies</option></select>
                    </div>

                    <div>
                        <label class="filter-label"><i class="fas fa-sitemap"></i> Department</label>
                        <select id="deptFilter" class="filter-input"><option value="">All Departments</option></select>
                    </div>

                    <div>
                        <label class="filter-label"><i class="fas fa-file"></i> Document Type</label>
                        <select id="docTypeFilter" class="filter-input"><option value="">All Types</option></select>
                    </div>

                    <div>
                        <label class="filter-label"><i class="fas fa-hashtag"></i> Document Number</label>
                        <input id="docNumFilter" class="filter-input" placeholder="Exact or partial document number" />
                    </div>

                    <div>
                        <label class="filter-label"><i class="fas fa-calendar-check"></i> Expiry Status</label>
                        <select id="expiryFilter" class="filter-input">
                            <option value="">All Documents</option>
                            <option value="Valid">Valid (Not Expired)</option>
                            <option value="Expired">Expired</option>
                        </select>
                    </div>

                    <button id="applyBtn" class="btn" type="button" style="width:100%"><i class="fas fa-filter"></i> APPLY FILTERS</button>
                </form>

                <div class="stats-card" style="margin-top:6px">
                    <div class="stats-title">TOTAL DOCUMENTS</div>
                    <div class="stats-value" id="totalDocuments">0</div>
                </div>

                <button id="exportBtn" class="btn btn-secondary" style="display:none"><i class="fas fa-download"></i> EXPORT CSV</button>
            </div>
        </div>

        <!-- Main -->
        <div class="main-content">
            <div class="header">
                <div class="header-content">
                    <div class="page-title">Document Repository</div>
                    <div style="display:flex;align-items:center;gap:12px">
                        <div id="resultsCount" style="background:#0f1724;padding:8px 12px;border-radius:8px;border:1px solid var(--border);color:var(--primary)">0 documents</div>
                    </div>
                </div>
            </div>

            <div class="results-section">
                <div id="resultsContainer" class="results-container">
                    <div class="loading"><div style="display:inline-block;width:36px;height:36px;border:4px solid #374151;border-top:4px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:10px"></div><div>Loading documents from database...</div></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* ---------- Config ---------- */
        const MASTER_PASSWORD = "pearl@123"; // same as before
        const loginScreen = document.getElementById('loginScreen');
        const mainApp = document.getElementById('mainApp');
        const loginForm = document.getElementById('loginForm');
        const passwordInput = document.getElementById('passwordInput');
        const loginBtn = document.getElementById('loginBtn');
        const loginError = document.getElementById('loginError');

        loginBtn.addEventListener('click', () => {
            const entered = passwordInput.value.trim();
            if (entered === MASTER_PASSWORD) {
                loginScreen.style.display = 'none';
                mainApp.style.display = 'flex';
                fetchDocuments();
            } else {
                loginError.style.display = 'block';
                passwordInput.value = '';
                setTimeout(()=> loginError.style.display='none', 3000);
            }
        });

        // convenience keypress: Enter on password
        passwordInput.addEventListener('keydown', (ev) => {
            if (ev.key === 'Enter') loginBtn.click();
        });

        /* ---------- Data handling ---------- */
        let allDocuments = [];

        async function fetchDocuments() {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = `<div class="loading"><div style="display:inline-block;width:36px;height:36px;border:4px solid #374151;border-top:4px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:10px"></div><div>Loading documents from database...</div></div>`;

            const SHEET_ID = document.getElementById('sheetId').value.trim();
            const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Sheet1`;
            try {
                const resp = await fetch(`${SHEET_URL}&t=${Date.now()}`);
                if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
                const text = await resp.text();

                if (text.includes('Google Docs') || text.includes('Requesting permission')) {
                    throw new Error('Google Sheet is not publicly accessible. Set "Anyone with the link can view".');
                }

                allDocuments = parseSheetData(text);
                if (!allDocuments || allDocuments.length === 0) {
                    document.getElementById('resultsContainer').innerHTML = `<div class="no-results"><i class="fas fa-file-search" style="font-size:38px;color:var(--border)"></i><h3>No documents found</h3><p style="color:var(--muted)">Ensure sheet contains rows and correct headers</p></div>`;
                    updateStats(0);
                    return;
                }

                updateStats(allDocuments.length);
                populateFilters(allDocuments);
                filterAndRender(allDocuments);
            } catch (err) {
                console.error(err);
                container.innerHTML = `<div class="error" style="padding:18px;border-radius:8px"><p><strong>Failed to load data:</strong> ${err.message}</p><p style="margin-top:8px;color:var(--muted)">Check sheet ID and "Anyone with the link can view" sharing.</p></div>`;
                updateStats(0);
            }
        }

        function updateStats(n) {
            document.getElementById('totalDocuments').textContent = n;
        }

        /* Robust CSV row parser that handles quoted commas */
        function splitCsvRow(row) {
            const cells = [];
            let inQuotes = false;
            let cur = '';
            for (let i=0;i<row.length;i++){
                const ch = row[i];
                if (ch === '"' ) {
                    // handle double quotes inside quoted string
                    if (inQuotes && row[i+1] === '"') {
                        cur += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (ch === ',' && !inQuotes) {
                    cells.push(cur);
                    cur = '';
                } else {
                    cur += ch;
                }
            }
            cells.push(cur);
            return cells.map(c => c.replace(/^"|"$/g,'').trim());
        }

        /* The sheet column order is confirmed:
            A Timestamp
            B Company
            C Department
            D Document Type
            E Document Number
            F Document Name
            G Document Code
            H Doc Date
            I Expiry Date
            J Remarks
            K File Name
            L File Size (MB)
            M URL
        */
        function parseSheetData(csvText) {
            const lines = csvText.split(/\r\n|\n/).filter(l=>l.trim()!=='');
            if (lines.length < 2) return [];

            const header = splitCsvRow(lines[0]);
            const docs = [];

            for (let r=1;r<lines.length;r++){
                const row = lines[r];
                if (!row.trim()) continue;
                const cells = splitCsvRow(row);

                // If row length is less than 13, pad to avoid index errors
                while (cells.length < 13) cells.push('');

                // Map according to confirmed order
                const timestamp = cells[0] || '';
                const company = (cells[1] || '').trim();
                const department = (cells[2] || '').trim();
                const documentType = (cells[3] || '').trim();
                const documentNumber = (cells[4] || '').trim();
                const documentName = (cells[5] || '').trim();
                const documentCode = (cells[6] || '').trim();
                const docDateRaw = (cells[7] || '').trim();
                const expiryRaw = (cells[8] || '').trim();
                const remarks = (cells[9] || '').trim();
                const fileName = (cells[10] || '').trim();
                const fileSize = (cells[11] || '').trim();
                const url = (cells[12] || '').trim();

                // Standardize dates to dd-mm-yyyy (if parseable) — fallback to raw
                const docDate = parseToDisplayDate(docDateRaw);
                const expiryDate = parseToDisplayDate(expiryRaw);

                // Determine expiry boolean (treat '-' or empty as no expiry)
                let isExpired = false;
                if (expiryDate && expiryDate !== '-') {
                    const parts = expiryDate.split('-'); // dd-mm-yyyy
                    if (parts.length === 3) {
                        const d = parseInt(parts[0],10), m = parseInt(parts[1],10)-1, y = parseInt(parts[2],10);
                        const expiryTime = new Date(y,m,d).setHours(0,0,0,0);
                        if (!isNaN(expiryTime)) {
                            const today = new Date(); today.setHours(0,0,0,0);
                            isExpired = expiryTime < today.getTime();
                        }
                    }
                }

                docs.push({
                    timestamp,
                    company,
                    department,
                    documentType,
                    documentNumber,
                    documentName,
                    documentCode,
                    docDate,
                    expiryDate,
                    remarks,
                    fileName,
                    fileSize,
                    url,
                    isExpired
                });
            }

            return docs;
        }

        // Try to parse various date formats into dd-mm-yyyy (if possible)
        function parseToDisplayDate(value) {
            if (!value || value === 'N/A' || value === '-') return '-';
            // If already dd-mm-yyyy or dd/mm/yyyy, normalize
            let v = value.trim();
            // Replace slashes with dashes
            v = v.replace(/\//g,'-');

            // If value looks like yyyy-mm-dd
            const isoMatch = v.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);
            if (isoMatch) {
                const y=isoMatch[1], m=isoMatch[2], d=isoMatch[3];
                return `${String(d).padStart(2,'0')}-${String(m).padStart(2,'0')}-${y}`;
            }

            // If value looks like dd-mm-yyyy or d-m-yyyy
            const dmyMatch = v.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);
            if (dmyMatch) {
                const d=dmyMatch[1], m=dmyMatch[2], y=dmyMatch[3];
                return `${String(d).padStart(2,'0')}-${String(m).padStart(2,'0')}-${y}`;
            }

            // Try Date parse fallback
            const tryDate = new Date(v);
            if (!isNaN(tryDate.getTime())) {
                const d = String(tryDate.getDate()).padStart(2,'0');
                const m = String(tryDate.getMonth()+1).padStart(2,'0');
                const y = tryDate.getFullYear();
                return `${d}-${m}-${y}`;
            }

            // otherwise return original raw value
            return value;
        }

        /* Populate company/department/type filters */
        function populateFilters(documents) {
            const companySelect = document.getElementById('companyFilter');
            const deptSelect = document.getElementById('deptFilter');
            const typeSelect = document.getElementById('docTypeFilter');

            companySelect.innerHTML = '<option value="">All Companies</option>';
            deptSelect.innerHTML = '<option value="">All Departments</option>';
            typeSelect.innerHTML = '<option value="">All Types</option>';

            const companies = new Set();
            const depts = new Set();
            const types = new Set();

            documents.forEach(d => {
                if (d.company) companies.add(d.company);
                if (d.department) depts.add(d.department);
                if (d.documentType) types.add(d.documentType);
            });

            Array.from(companies).sort().forEach(c => {
                const opt = document.createElement('option'); opt.value = c; opt.textContent = c; companySelect.appendChild(opt);
            });
            Array.from(depts).sort().forEach(c => {
                const opt = document.createElement('option'); opt.value = c; opt.textContent = c; deptSelect.appendChild(opt);
            });
            Array.from(types).sort().forEach(c => {
                const opt = document.createElement('option'); opt.value = c; opt.textContent = c; typeSelect.appendChild(opt);
            });
        }

        function filterAndRender(documents) {
            const search = (document.getElementById('searchTerm').value || '').trim().toLowerCase();
            const company = (document.getElementById('companyFilter').value || '').trim();
            const dept = (document.getElementById('deptFilter').value || '').trim();
            const docType = (document.getElementById('docTypeFilter').value || '').trim();
            const docNum = (document.getElementById('docNumFilter').value || '').trim();
            const expiryStatus = (document.getElementById('expiryFilter').value || '').trim();

            let filtered = documents.filter(d => {
                if (company && d.company !== company) return false;
                if (dept && d.department !== dept) return false;
                if (docType && d.documentType !== docType) return false;
                if (docNum) {
    const cleanInput = docNum.toLowerCase().replace(/[^a-z0-9]/g, '');
    const cleanDocNum = (d.documentNumber || '').toLowerCase().replace(/[^a-z0-9]/g, '');
    if (!cleanDocNum.includes(cleanInput)) return false;
                    }
                if (expiryStatus === 'Expired' && !d.isExpired) return false;
                if (expiryStatus === 'Valid' && d.isExpired) return false;
                if (search) {
                    const hay = `${d.company} ${d.department} ${d.documentType} ${d.documentNumber} ${d.documentName} ${d.documentCode} ${d.remarks} ${d.fileName}`.toLowerCase();
                    if (!hay.includes(search)) return false;
                }
                return true;
            });

            renderDocuments(filtered);
            const exportBtn = document.getElementById('exportBtn');
            exportBtn.style.display = filtered.length ? 'block' : 'none';
            exportBtn.onclick = () => exportToCSV(filtered);
        }

        /* Render table with EXACT columns you requested (without TIMESTAMP) */
        function renderDocuments(documents) {
            const container = document.getElementById('resultsContainer');
            const resultsCount = document.getElementById('resultsCount');
            resultsCount.textContent = `${documents.length} document${documents.length !== 1 ? 's' : ''}`;
            if (!documents.length) {
                container.innerHTML = `<div class="no-results"><i class="fas fa-file-search" style="font-size:40px;color:var(--border)"></i><h3>No documents found</h3><p style="color:var(--muted)">Try changing filters</p></div>`;
                return;
            }

            let html = `<div class="table-container"><table class="document-table">
                <thead>
                  <tr>
                    <th>Company</th>
                    <th>Department</th>
                    <th>Document Type</th>
                    <th>Document Number</th>

                    <th>Document Name</th>
                    <th>Document Code</th>
                    <th>Doc Date</th>
                    <th>Expiry Date</th>

                    <th>Remarks</th>
                    <th>File Name</th>
                    <th>File Size (MB)</th>
                    <th>URL</th>
                  </tr>
                </thead>
                <tbody>`;

            documents.forEach(d => {
                const expiredClass = d.isExpired ? 'expired-row' : '';
                const badge = d.isExpired ? `<span class="status-badge status-expired">EXPIRED</span>` : `<span class="status-badge status-valid">VALID</span>`;
                html += `<tr class="${expiredClass}">`;
                html += `<td><strong>${escapeHtml(d.company)}</strong></td>`;
                html += `<td>${escapeHtml(d.department) || '-'}</td>`;
                html += `<td>${escapeHtml(d.documentType) || '-'}</td>`;
                html += `<td>${escapeHtml(d.documentNumber) || '-'}</td>`;

                html += `<td>${escapeHtml(d.documentName) || '-'}</td>`;
                html += `<td><code>${escapeHtml(d.documentCode) || '-'}</code></td>`;
                html += `<td>${escapeHtml(d.docDate) || '-'}</td>`;
                html += `<td>${escapeHtml(d.expiryDate) === '-' ? '-' : escapeHtml(d.expiryDate) + '<div style="margin-top:6px">' + badge + '</div>'}</td>`;

                html += `<td>${escapeHtml(d.remarks) || '-'}</td>`;
                html += `<td>${escapeHtml(d.fileName) || '-'}</td>`;
                html += `<td>${escapeHtml(d.fileSize) || '-'}</td>`;

                html += `<td>`;
                if (d.url && (d.url.startsWith('http') || d.url.startsWith('https'))) {
                    html += `<a class="document-link" href="${escapeAttr(d.url)}" target="_blank"><i class="fas fa-external-link-alt"></i> View</a>`;
                } else if (d.url) {
                    html += escapeHtml(d.url);
                } else {
                    html += `-`;
                }
                html += `</td>`;

                html += `</tr>`;
            });

            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }

        // CSV export — columns exactly as requested (no timestamp)
        function exportToCSV(documents) {
            const headers = [
                "COMPANY",
                "DEPARTMENT",
                "DOCUMENT TYPE",
                "DOCUMENT NUMBER",
                "DOCUMENT NAME",
                "DOCUMENT CODE",
                "DOC DATE",
                "EXPIRY DATE",
                "REMARKS",
                "FILE NAME",
                "FILE SIZE (MB)",
                "URL"
            ];
            let csv = headers.join(',') + '\n';
            documents.forEach(d => {
                const row = [
                    csvEscape(d.company),
                    csvEscape(d.department),
                    csvEscape(d.documentType),
                    csvEscape(d.documentNumber),
                    csvEscape(d.documentName),
                    csvEscape(d.documentCode),
                    csvEscape(d.docDate),
                    csvEscape(d.expiryDate),
                    csvEscape(d.remarks),
                    csvEscape(d.fileName),
                    csvEscape(d.fileSize),
                    csvEscape(d.url)
                ];
                csv += row.join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            const fn = `document_report_${new Date().toISOString().split('T')[0]}.csv`;
            link.setAttribute('download', fn);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        /* Utilities */
        function escapeHtml(str) {
            if (!str && str !== 0) return '';
            return String(str)
                .replace(/&/g,'&amp;')
                .replace(/</g,'&lt;')
                .replace(/>/g,'&gt;')
                .replace(/"/g,'&quot;')
                .replace(/'/g,'&#39;');
        }
        function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;'); }
        function csvEscape(v) {
            if (v === null || v === undefined) return '""';
            const s = String(v);
            if (s.includes(',') || s.includes('"') || s.includes('\n')) {
                return `"${s.replace(/"/g,'""')}"`;
            }
            return `"${s}"`;
        }

        /* Hook up UI events */
        document.getElementById('applyBtn').addEventListener('click', () => {
            if (allDocuments.length) filterAndRender(allDocuments);
        });
        document.getElementById('searchTerm').addEventListener('input', ()=>{ if (allDocuments.length) filterAndRender(allDocuments); });
        document.getElementById('companyFilter').addEventListener('change', ()=>{ if (allDocuments.length) filterAndRender(allDocuments); });
        document.getElementById('deptFilter').addEventListener('change', ()=>{ if (allDocuments.length) filterAndRender(allDocuments); });
        document.getElementById('docTypeFilter').addEventListener('change', ()=>{ if (allDocuments.length) filterAndRender(allDocuments); });
        document.getElementById('docNumFilter').addEventListener('input', ()=>{ if (allDocuments.length) filterAndRender(allDocuments); });
        document.getElementById('expiryFilter').addEventListener('change', ()=>{ if (allDocuments.length) filterAndRender(allDocuments); });

        // small animation keyframes (injected)
        (function injectKeyframes(){
            const el = document.createElement('style');
            el.innerHTML = '@keyframes spin{to{transform:rotate(360deg)}}';
            document.head.appendChild(el);
        })();

    </script>
</body>
</html>
